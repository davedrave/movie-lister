<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dave's Physical Media</title>
    
</head>
<body>

<header>
    <h1>Dave's Physical Media</h1>
    <input type="text" id="search" placeholder="Search collection...">
</header>

<div class="table-container">
    <table class="movie-table">
        <thead>
            <tr>
                <th style="width: 10%;">Year</th>
                <th style="width: 70%;">Title</th>
                <th style="width: 20%;">Format</th>
            </tr>
        </thead>
        <tbody id="movie-rows">
            <tr>
                <td colspan="3" class="loading">Fetching latest data...</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    let allMovies = [];
    // URL to your public physical-movie-repo JSON
    // The Date.now() part forces GitHub to bypass the 5-minute cache
    const DATA_URL = 'https://raw.githubusercontent.com/davedrave/physical-movie-repo/refs/heads/main/movies.json?v=' + Date.now();

    async function loadData() {
        try {
            const response = await fetch(DATA_URL);
            if (!response.ok) throw new Error('Failed to reach data repo');
            
            allMovies = await response.json();
            displayMovies(allMovies);
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('movie-rows').innerHTML = `
                <tr><td colspan="3" style="color: #cf6679;">Error: Could not load data. Check URL.</td></tr>
            `;
        }
    }

    function displayMovies(movies) {
        const tbody = document.getElementById('movie-rows');
        
        if (movies.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3">No movies found.</td></tr>';
            return;
        }

        tbody.innerHTML = movies.map(m => `
            <tr>
                <td style="color: #888;">${m.year}</td>
                <td style="font-weight: 500;">${m.title}</td>
                <td>
                    <span class="format-pill ${m.format.toLowerCase().includes('4k') ? 'tag-4k' : 'tag-blu'}">
                        ${m.format}
                    </span>
                </td>
            </tr>
        `).join('');
    }

    // Search logic
    document.getElementById('search').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allMovies.filter(m => 
            m.title.toLowerCase().includes(term) || 
            m.year.toString().includes(term)
        );
        displayMovies(filtered);
    });

    loadData();
</script>

</body>
</html>